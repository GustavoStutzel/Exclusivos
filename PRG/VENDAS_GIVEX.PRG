

****EXPORTA SMS ABRAND****************************

TEXT TO XSEL NOSHOW TEXTMERGE


SELECT V.CODIGO_FILIAL AS COD,L.FILIAL,V.TICKET,CONVERT(CHAR,V.DATA_VENDA,102) AS DATA_VENDA,
V.CODIGO_CLIENTE,

CASE
WHEN V.VALOR_TIKET < '0.00' THEN V.VALOR_TIKET*(-1)
ELSE V.VALOR_TIKET END AS VALOR_TICKET,

CASE WHEN V.VALOR_PAGO = '1.00' AND VALOR_TIKET < '80.00' THEN '0.00'
WHEN V.VALOR_PAGO < '0.00' THEN V.VALOR_PAGO*(-1)
ELSE V.VALOR_PAGO END AS VALOR_PAGO,

CASE WHEN VALOR_TIKET BETWEEN '0.00' AND '80.00' THEN V.VALOR_TIKET
WHEN W.VALOR_VALE < '0.00' THEN '80.00'
ELSE W.VALOR_VALE END AS VALOR_VALE

FROM LOJA_VENDA V 
INNER JOIN LOJAS_VAREJO L   
ON V.CODIGO_FILIAL = L.CODIGO_FILIAL 
LEFT JOIN   
(SELECT CODIGO_FILIAL, TERMINAL, LANCAMENTO_CAIXA, SUM(ISNULL(VALOR_MOEDA, 0)) AS VALOR_VALE      
FROM LOJA_VENDA_PARCELAS      
WHERE TIPO_PGTO = 'R'      
GROUP BY CODIGO_FILIAL, TERMINAL, LANCAMENTO_CAIXA) W 
ON L.CODIGO_FILIAL = W.CODIGO_FILIAL 
AND V.TERMINAL = W.TERMINAL 
AND V.LANCAMENTO_CAIXA = W.LANCAMENTO_CAIXA 
WHERE V.CODIGO_DESCONTO = 'GV'    
AND W.VALOR_VALE > 0 
ORDER BY V.CODIGO_FILIAL,DATA_VENDA
 

ENDTEXT 

F_SELECT(XSEL,"CUR_EXPORTA")

SELE CUR_EXPORTA
COPY TO "C:\TEMP\VENDAS_GIVEX.XLS" XLS 